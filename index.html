<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>eppel construct — Structural design</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --bg:#0f172a; --text:#e5e7eb; --muted:#9aa4b2; --border:#243042; --card:#111827; --grad-start:#7c3aed; --grad-end:#d946ef; --toast-bg:#16a34a; --accent:#60a5fa; }
    [data-theme="light"] { --bg:#fff; --text:#0f172a; --muted:#475569; --border:#e5e7eb; --card:#fff; --toast-bg:#22c55e; --accent:#2563eb; }
    body{background:var(--bg);color:var(--text)}
    .card{border:1px solid var(--border);background:var(--card);border-radius:1rem}
    .grad{background-image:linear-gradient(90deg,var(--grad-start),var(--grad-end))}
    .btn{padding:.75rem 1rem;border-radius:1rem;display:inline-block}
    .btn-primary{color:#fff;background-image:linear-gradient(90deg,var(--grad-start),var(--grad-end))}
    .toast{visibility:hidden;min-width:260px;background:var(--toast-bg);color:#fff;border-radius:12px;padding:14px 18px;position:fixed;z-index:999;left:50%;bottom:-100px;transform:translateX(-50%);opacity:0;transition:opacity .45s,bottom .45s}
    .toast.show{visibility:visible;opacity:1;bottom:42px}
    .theme-toggle{position:fixed;left:16px;bottom:16px;z-index:60;display:flex;gap:.5rem;align-items:center}
    .theme-btn{width:56px;height:56px;border-radius:9999px;border:1px solid var(--border);background:var(--card);display:flex;align-items:center;justify-content:center}
    .album-btn{padding:.4rem .7rem;border:1px solid var(--border);border-radius:.75rem;cursor:pointer}
    .album-btn.active{background:rgba(124,58,237,.12);border-color:rgba(124,58,237,.35)}
    #gallery { column-gap: 1rem; }
    @media (min-width: 640px){ #gallery { column-count: 2; } }
    @media (min-width: 768px){ #gallery { column-count: 3; } }
    .masonry-item { break-inside: avoid; margin: 0 0 1rem; display: inline-block; width: 100%; }
    .masonry-item img { width: 100%; height: auto; display:block; }
    .lightbox { position: fixed; inset: 0; z-index: 1000; background: rgba(0,0,0,.85); display: none; align-items: center; justify-content: center; }
    .lightbox.open { display: flex; }
    .lightbox-content { position: relative; max-width: 92vw; max-height: 86vh; }
    .lightbox img { max-width: 92vw; max-height: 70vh; border-radius: 12px; display:block; }
    .lightbox .caption { color: #fff; text-align: center; margin-top: .75rem; opacity: .9; }
    .lb-btn { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,.15); color: #fff; border: none; width: 44px; height: 44px; border-radius: 9999px; cursor: pointer; }
    .lb-prev { left: -56px; } .lb-next { right: -56px; }
    .lb-close { position: absolute; top: -52px; right: 0; background: rgba(255,255,255,.15); color: #fff; border: none; width: 40px; height: 40px; border-radius: 9999px; cursor: pointer; }
    a.link { color: var(--accent); }
  </style>
</head>
<body>
  <div id="successToast" class="toast">✅ Your message has been sent successfully!</div>

  <header class="sticky top-0 z-50 border-b bg-white/10 backdrop-blur">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <div class="h-6 w-6 rounded-md grad"></div>
        <span class="font-bold lowercase">eppel construct</span>
      </div>
      <nav class="hidden md:flex gap-3">
        <a href="#home" class="px-3 py-2 rounded-xl border">Home</a>
        <a href="#projects" class="px-3 py-2 rounded-xl border">Recent work</a>
        <a href="#contact" class="px-3 py-2 rounded-xl border">Contact</a>
      </nav>
      <a href="#contact" class="btn btn-primary hidden md:inline-block">Request a quote</a>
    </div>
  </header>

  <main id="app" class="max-w-6xl mx-auto px-4 py-8 space-y-12">
    <section id="home" class="space-y-3">
      <div class="chip grad inline-block text-white px-2 py-1 rounded-full text-xs">Structural Engineering · Romania</div>
      <h1 class="text-3xl md:text-5xl font-extrabold">Design for reinforced concrete & steel structures</h1>
      <p class="text-slate-300 max-w-3xl">BIM‑ready deliverables and shop drawings crews can build from.</p>
    </section>

    <section id="projects" class="space-y-3">
      <h2 class="text-2xl md:text-3xl font-semibold">Recent work</h2>
      <div id="albumFilters" class="flex flex-wrap gap-2"></div>
      <div id="albumLinks" class="text-sm text-slate-400"></div>
      <div id="gallery"></div>
      <p class="text-sm text-slate-400">Manage albums and images at <a class="link" href="/admin">/admin</a>.</p>
    </section>

    <section id="contact" class="space-y-3">
      <h2 class="text-2xl md:text-3xl font-semibold">Contact</h2>
      <form class="card p-6 space-y-4 max-w-2xl" action="https://formspree.io/f/mgvzdeny" method="POST" onsubmit="submitSpree(event)">
        <div class="grid md:grid-cols-2 gap-4">
          <input class="border rounded-xl px-3 py-2 bg-transparent" name="name" placeholder="Full name" required>
          <input class="border rounded-xl px-3 py-2 bg-transparent" type="email" name="email" placeholder="Email address" required>
          <textarea class="border rounded-xl px-3 py-2 md:col-span-2 bg-transparent" rows="5" name="message" placeholder="Tell us about your project" required></textarea>
        </div>
        <button class="btn btn-primary" type="submit">Send message</button>
      </form>
    </section>
  </main>

  <div style="position:fixed;right:16px;bottom:16px">
    <a class="grad" style="width:56px;height:56px;border-radius:9999px;display:flex;align-items:center;justify-content:center" href="https://wa.me/40723234792?text=Salut%20eppel%20construct%2C%20a%C8%99%20dori%20o%20ofert%C4%83%20de%20proiectare" target="_blank" rel="noopener" aria-label="WhatsApp">
      <svg viewBox="0 0 32 32" fill="white" width="26" height="26" aria-hidden="true"><path d="M19.11 17.17c-.27-.14-1.6-.79-1.84-.87-.25-.09-.43-.14-.6.14-.18.27-.69.86-.85 1.03-.16.18-.31.2-.58.07-.27-.14-1.14-.42-2.17-1.34-.8-.71-1.34-1.58-1.5-1.85-.16-.27-.02-.41.12-.54.12-.12.27-.31.4-.47.14-.16.18-.27.27-.45.09-.18.05-.34-.02-.47-.07-.14-.6-1.43-.82-1.96-.22-.53-.44-.46-.6-.46-.16 0-.34-.02-.52-.02-.18 0-.47.07-.72.34-.25.27-.95.93-.95 2.27s.98 2.63 1.12 2.81c.14.18 1.92 2.93 4.65 4.1..."/></svg>
    </a>
  </div>

  <div class="theme-toggle">
    <button id="themeBtn" class="theme-btn" aria-label="Toggle theme">
      <svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4 12H2M22 12h-2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"/></svg>
      <svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" style="display:none"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
    </button>
    <span class="text-sm" style="color:var(--muted)">Theme</span>
  </div>

  <div id="lightbox" class="lightbox" aria-modal="true" role="dialog">
    <div class="lightbox-content">
      <img id="lbImg" src="" alt="" />
      <div id="lbCaption" class="caption"></div>
      <button class="lb-btn lb-prev" aria-label="Previous" id="lbPrev">‹</button>
      <button class="lb-btn lb-next" aria-label="Next" id="lbNext">›</button>
      <button class="lb-close" aria-label="Close" id="lbClose">✕</button>
    </div>
  </div>

  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <script>
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on('init', (user) => {
        if (!user) window.netlifyIdentity.on('login', () => { document.location.href = '/admin/'; });
      });
    }
  </script>

<script>
function applyTheme(t){
  document.documentElement.setAttribute('data-theme', t);
  localStorage.setItem('theme', t);
  document.getElementById('sunIcon').style.display = t==='dark' ? 'none' : 'block';
  document.getElementById('moonIcon').style.display = t==='dark' ? 'block' : 'none';
}
document.addEventListener('DOMContentLoaded', ()=>{
  const saved = localStorage.getItem('theme');
  applyTheme(saved || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'));
  document.getElementById('themeBtn').addEventListener('click', ()=>{
    const next = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
    applyTheme(next);
  });
});

function submitSpree(e){
  e.preventDefault();
  const form = e.target;
  fetch(form.action, { method:'POST', body:new FormData(form), headers:{'Accept':'application/json'} })
    .then(r => r.ok ? (window.location.href='thankyou.html') : alert('Error sending message.'))
    .catch(() => alert('Network error.'));
}

document.addEventListener('DOMContentLoaded', () => {
  const params = new URLSearchParams(location.search);
  if (params.get('sent') === '1') {
    const el = document.getElementById('successToast');
    el.classList.add('show');
    setTimeout(()=> el.classList.remove('show'), 5000);
    el.addEventListener('click', ()=> el.classList.remove('show'));
  }
});

let CURRENT_IMAGES = [];
let CURRENT_INDEX = 0;

async function loadAlbums(){
  try {
    const res = await fetch('/.netlify/functions/albums-index');
    const data = await res.json();
    const albums = data.albums || [];
    renderAlbums(albums);
  } catch(e){ console.error(e); }
}

function renderAlbums(albums){
  const filters = document.getElementById('albumFilters');
  filters.innerHTML='';

  const tagSet = new Set();
  albums.forEach(a => (a.tags||[]).forEach(t => tagSet.add(String(t).toLowerCase())));

  function addPill(label, onClick, active=false){
    const b = document.createElement('button');
    b.className = 'album-btn' + (active ? ' active' : '');
    b.textContent = label;
    b.onclick = () => { document.querySelectorAll('.album-btn').forEach(x=>x.classList.remove('active')); b.classList.add('active'); onClick(); };
    filters.appendChild(b);
  }

  addPill('All', () => {
    const allImages = albums.flatMap(a => a.images.map(img => ({...img, _album:a.title})));
    renderGallery(allImages);
  }, true);

  [...tagSet].sort().forEach(tag => {
    addPill('#'+tag, () => {
      const imgs = albums
        .filter(a => (a.tags||[]).map(t=>String(t).toLowerCase()).includes(tag))
        .flatMap(a => a.images.map(img => ({...img, _album:a.title})));
      renderGallery(imgs);
    });
  });

  const links = document.getElementById('albumLinks');
  links.innerHTML = albums.map(a => {
    const slug = a.slug || a.title.toLowerCase().replace(/\s+/g,'-');
    return `<a class="underline mr-3" href="album.html?a=${encodeURIComponent(slug)}">${a.title}</a>`;
  }).join('');

  const allImages = albums.flatMap(a => a.images.map(img => ({...img, _album:a.title})));
  renderGallery(allImages);
}

function renderGallery(images){
  CURRENT_IMAGES = images;
  const g = document.getElementById('gallery');
  g.innerHTML = images.map((img, i) => `
    <figure class="masonry-item card overflow-hidden" data-idx="${i}">
      <img src="/.netlify/images?url=${encodeURIComponent(img.src)}&w=1200&fit=cover&auto=compress" alt="${img.caption||''}" loading="lazy" />
      ${img.caption ? `<figcaption class="p-3 text-sm" style="color:var(--muted)">${img.caption}</figcaption>` : ''}
    </figure>
  `).join('');
  g.querySelectorAll('.masonry-item img').forEach((el)=>{
    el.addEventListener('click', (ev)=>{
      const idx = Number(ev.target.closest('.masonry-item').dataset.idx);
      openLightbox(idx);
    });
  });
}

const lb = document.getElementById('lightbox');
const lbImg = document.getElementById('lbImg');
const lbCaption = document.getElementById('lbCaption');
const lbPrev = document.getElementById('lbPrev');
const lbNext = document.getElementById('lbNext');
const lbClose = document.getElementById('lbClose');

function openLightbox(i){
  CURRENT_INDEX = i;
  const item = CURRENT_IMAGES[CURRENT_INDEX];
  lbImg.src = `/.netlify/images?url=${encodeURIComponent(item.src)}&w=1800&fit=inside&auto=compress`;
  lbImg.alt = item.caption || '';
  lbCaption.textContent = item.caption || '';
  lb.classList.add('open');
  document.body.style.overflow = 'hidden';
}
function closeLightbox(){ lb.classList.remove('open'); document.body.style.overflow = ''; }
function nextImg(){ CURRENT_INDEX = (CURRENT_INDEX + 1) % CURRENT_IMAGES.length; openLightbox(CURRENT_INDEX); }
function prevImg(){ CURRENT_INDEX = (CURRENT_INDEX - 1 + CURRENT_IMAGES.length) % CURRENT_IMAGES.length; openLightbox(CURRENT_INDEX); }
lbNext.addEventListener('click', nextImg);
lbPrev.addEventListener('click', prevImg);
lbClose.addEventListener('click', closeLightbox);
lb.addEventListener('click', (e)=>{ if(e.target === lb) closeLightbox(); });
document.addEventListener('keydown', (e)=>{
  if (!lb.classList.contains('open')) return;
  if (e.key === 'Escape') closeLightbox();
  if (e.key === 'ArrowRight') nextImg();
  if (e.key === 'ArrowLeft') prevImg();
});

document.addEventListener('DOMContentLoaded', loadAlbums);
</script>
</body>
</html>
